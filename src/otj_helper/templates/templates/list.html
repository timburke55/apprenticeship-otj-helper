{% extends "base.html" %}
{% block title %}Activity Templates{% endblock %}

{% block content %}
<div class="mb-6 sm:flex sm:items-center sm:justify-between">
    <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Activity Templates</h1>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Reusable templates to quickly log common activities.</p>
    </div>
    <a href="{{ url_for('templates.create') }}"
        class="mt-3 sm:mt-0 inline-flex rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
        + New Template
    </a>
</div>

{% if templates %}
<div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    {% for tmpl in templates %}
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden flex flex-col">
        <div class="p-4 flex-1">
            <div class="flex items-start justify-between gap-2">
                <h2 class="text-base font-semibold text-gray-900 dark:text-white">{{ tmpl.name }}</h2>
                {% if tmpl.is_recurring %}
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 flex-shrink-0">
                    {{ recurrence_day_labels.get(tmpl.recurrence_day, '?') }}s
                </span>
                {% endif %}
            </div>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400 truncate">{{ tmpl.title }}</p>
            <div class="mt-2 flex flex-wrap gap-1">
                <span class="inline-flex items-center rounded px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300">
                    {{ activity_type_labels.get(tmpl.activity_type, tmpl.activity_type) }}
                </span>
                {% if tmpl.duration_hours is not none %}
                <span class="inline-flex items-center rounded px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300">
                    {{ "%.1f"|format(tmpl.duration_hours) }}h
                </span>
                {% endif %}
            </div>
            {% if tmpl.ksb_codes_csv %}
            <div class="mt-2 flex flex-wrap gap-1">
                {% for code in tmpl.ksb_codes_csv.split(',') %}
                {% if code.strip() %}
                {% set nat = natural_code(code.strip()) %}
                {% set cat_char = nat[0]|upper if nat else '' %}
                <span class="inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium
                    {% if cat_char == 'K' %}bg-knowledge-light text-knowledge-dark
                    {% elif cat_char == 'S' %}bg-skill-light text-skill-dark
                    {% else %}bg-behaviour-light text-behaviour-dark{% endif %}">
                    {{ nat }}
                </span>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div class="border-t border-gray-100 dark:border-gray-700 px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex gap-2">
            <a href="{{ url_for('templates.use_template', template_id=tmpl.id) }}"
                class="flex-1 text-center rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500">
                Use
            </a>
            <a href="{{ url_for('templates.edit', template_id=tmpl.id) }}"
                class="rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600">
                Edit
            </a>
            <form method="post" action="{{ url_for('templates.delete', template_id=tmpl.id) }}"
                onsubmit="return confirm('Delete this template?')">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                    class="rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-xs font-medium text-red-600 dark:text-red-400 shadow-sm ring-1 ring-inset ring-red-200 dark:ring-red-800 hover:bg-red-50 dark:hover:bg-red-900/20">
                    Delete
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-12">
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">No templates yet. Create a reusable template to quickly log common activities.</p>
    <a href="{{ url_for('templates.create') }}"
        class="inline-flex rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
        Create your first template
    </a>
</div>
{% endif %}
{% endblock %}
